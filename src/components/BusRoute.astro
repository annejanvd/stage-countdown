---
---
<div class="flex flex-col items-center justify-center p-4 h-full w-full">
    <div class="flex justify-between items-center w-full mb-1">
        <div class="flex items-center gap-3 w-1/3">
            <div class="flex flex-col">
                <span id="bus-line" class="text-text-secondary uppercase tracking-wider text-xs font-medium">Lijn --</span>
                <span id="bus-start-name" class="text-text-primary font-semibold text-sm leading-tight" title="Start">Start</span>
            </div>
        </div>
        
        <div class="flex-1 mx-4 flex items-center relative h-1 bg-white/10 rounded-full">
             <div class="absolute left-0 top-1/2 -translate-y-1/2 w-2 h-2 rounded-full bg-text-muted"></div>
             <div class="absolute right-0 top-1/2 -translate-y-1/2 w-2 h-2 rounded-full bg-text-muted"></div>
             <div class="absolute left-1/2 top-1/2 -translate-y-1/2 -translate-x-1/2 bg-bg-base border border-white/20 px-2 py-0.5 rounded text-[10px] text-text-muted">
                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 5m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z" /><path d="M9 17l6 0" /><path d="M6 10l12 0" /><path d="M9 5l0 5" /><path d="M15 5l0 5" /></svg>
             </div>
        </div>

        <div class="flex flex-col items-end w-1/3 text-right">
            <span id="bus-end-name" class="text-text-primary font-semibold text-sm leading-tight" title="End">End</span>
        </div>
    </div>

    <div class="flex items-center gap-8 mt-2">
        <div class="flex flex-col items-center">
            <span class="text-text-secondary text-[10px] uppercase tracking-wider">Departing</span>
            <span id="bus-status-val" class="font-mono text-2xl font-bold tabular-nums">--</span>
        </div>
        <div class="w-px h-8 bg-white/10"></div>
        <div class="flex flex-col items-center">
            <span class="text-text-secondary text-[10px] uppercase tracking-wider">Next</span>
            <span id="bus-next-val" class="font-mono text-lg text-text-muted tabular-nums">--</span>
        </div>
    </div>
</div>

<script>
    function applyColor(el: HTMLElement, minutes: number) {
        const base = 'font-mono font-bold tabular-nums';
        if (minutes <= 0) { el.className = `${base} text-2xl text-temp-hot`; return; }
        if (minutes < 5) el.className = `${base} text-2xl text-temp-hot`;
        else if (minutes < 15) el.className = `${base} text-2xl text-temp-normal`;
        else el.className = `${base} text-2xl text-temp-cold`;
    }

    async function fetchBusData() {
        try {
            const res = await fetch('/api/bus');
            const data = await res.json();
            
            const startEl = document.getElementById('bus-start-name');
            const endEl = document.getElementById('bus-end-name');
            const lineEl = document.getElementById('bus-line');
            const el = document.getElementById('bus-status-val');
            const nextEl = document.getElementById('bus-next-val');
            
            if (startEl && data.startName) startEl.textContent = data.startName;
            if (endEl && data.endName) endEl.textContent = data.endName;
            if (lineEl && data.line) lineEl.textContent = `Lijn ${data.line}`;

            if (el) {
                if (data.error) {
                    el.textContent = 'Err';
                    el.className = 'font-mono text-2xl font-bold tabular-nums text-status-warning';
                } else if (data.current) {
                    const timeStr = new Date(data.current.time).toLocaleTimeString('nl-NL', { hour: '2-digit', minute: '2-digit' });
                    el.textContent = data.current.minutes <= 0 ? 'Now' : timeStr;
                    applyColor(el, data.current.minutes);
                }
            }

            if (nextEl) {
                if (data.next) {
                    const nextTimeStr = new Date(data.next.time).toLocaleTimeString('nl-NL', { hour: '2-digit', minute: '2-digit' });
                    nextEl.textContent = nextTimeStr;
                    nextEl.className = 'font-mono text-lg text-text-muted tabular-nums';
                } else {
                    nextEl.textContent = '--';
                }
            }
        } catch {}
    }
    fetchBusData();
    setInterval(fetchBusData, 120000);
</script>
